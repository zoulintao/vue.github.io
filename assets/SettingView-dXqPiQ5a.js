import{m as g,_ as C,r as N,a as c,c as S,b as P,d as r,w as d,u as A,e as p,f as W,h as f,s as _,E as w,v as y}from"./index-zbuosgjY.js";const z=(i,u)=>g({method:"post",url:"/setting/verificationPassword",data:{id:i,pwd:u}}),D=(i,u,l)=>g({method:"post",url:"/setting/setNewPassword",data:{id:i,pwd:u,newPwd:l}}),U=i=>g({method:"post",url:"/setting/delUser",data:{id:i}}),Z={class:"setting"},B={class:"setting_box"},E={__name:"SettingView",setup(i){const u=A(),l=N(),t=c({pwd:"",newPwd:""}),$=c({pwd:[{validator:(o,e,a)=>{if(e==="")a(new Error("请输入密码！"));else{if(t.pwd!==""||t.newPwd!==""){const s=new RegExp(/^(?![a-zA-Z]+$)(?![A-Z0-9]+$)(?![A-Z\W_!@#$%^&*`~()-+=]+$)(?![a-z0-9]+$)(?![a-z\W_!@#$%^&*`~()-+=]+$)(?![0-9\W_!@#$%^&*`~()-+=]+$)[a-zA-Z0-9\W_!@#$%^&*`~()-+=]/);if(s.test(t.pwd)||s.test(t.newPwd)){if(!l.value)return;l.value.validateField("checkPass",()=>null)}}a()}},trigger:"blur",required:!0},{min:3,max:30,message:"长度为3~30个字符"}]}),b=o=>{o&&o.validate(e=>{if(e){let a=_("userData").id;z(a,t.pwd).then(s=>{s.code!=200&&w({message:"旧密码输入错误！",type:"error",duration:1200})})}})},x=o=>{o&&o.validate(e=>{if(e){let a=_("userData").id;D(a,t.pwd,t.newPwd).then(s=>{s.code===200?(w({message:"设置成功！",type:"success",duration:1200}),t.pwd="",t.newPwd="",v()):w({message:"设置错误,请确认旧密码正确！",type:"error",duration:1200})})}else return w({message:"请完善信息!",type:"error",duration:1200}),!1})},v=()=>{localStorage.clear(),y("userData"),y("token"),u.replace("/")},V=()=>{let o=_("userData").id;localStorage.clear(),u.replace("/"),U(o)};return(o,e)=>{const a=p("el-input"),s=p("el-form-item"),m=p("el-button"),k=p("el-form");return W(),S("div",Z,[P("div",B,[r(k,{"label-position":"top","label-width":"100px",model:t,style:{"max-width":"60%"},ref_key:"rulePass",ref:l,rules:$},{default:d(()=>[e[9]||(e[9]=P("p",{class:"text_1",prop:"pass"},"修改密码",-1)),r(s,{label:"旧密码",prop:"pwd"},{default:d(()=>[r(a,{modelValue:t.pwd,"onUpdate:modelValue":e[0]||(e[0]=n=>t.pwd=n),type:"password",onChange:e[1]||(e[1]=n=>b(l.value))},null,8,["modelValue"])]),_:1}),r(s,{label:"新密码",prop:"pwd"},{default:d(()=>[r(a,{modelValue:t.newPwd,"onUpdate:modelValue":e[2]||(e[2]=n=>t.newPwd=n),type:"password"},null,8,["modelValue"])]),_:1}),r(s,null,{default:d(()=>[r(m,{type:"primary",onClick:e[3]||(e[3]=n=>x(l.value)),class:"btn"},{default:d(()=>e[6]||(e[6]=[f("确认修改")])),_:1})]),_:1}),r(m,{type:"primary",onClick:e[4]||(e[4]=n=>v()),class:"btn_out"},{default:d(()=>e[7]||(e[7]=[f("退出登录")])),_:1}),r(m,{type:"primary",onClick:e[5]||(e[5]=n=>V()),class:"btn_out"},{default:d(()=>e[8]||(e[8]=[f("注销用户")])),_:1})]),_:1},8,["model","rules"])])])}}},R=C(E,[["__scopeId","data-v-a447484b"]]);export{R as default};
